version: 1
contracts:
  - name: "Payment Flow Success"
    description: "Ensure successful payment traces include key spans and attributes"
    query: "service:payment-api operation_name:POST /payments"
    window:
      minutes: 15
    expected_spans:
      - name: "POST /payments"
        service: "payment-api"
        min_count: 50
        max_latency_ms: 3000
        tags:
          - key: "payment.status"
            expected: "success"
          - key: "customer.id"
            required: true

      - name: "adyen.charge"
        service: "adyen-client"
        tags:
          - key: "adyen.response_code"
            expected: "200"
          - key: "adyen.currency"
            expected_any_of: ["GBP", "EUR"]

  - name: "Checkout Flow Observability"
    description: "Ensure checkout emits all key spans and attributes"
    query: "service:checkout-api operation_name:POST /checkout"
    expected_spans:
      - name: "POST /checkout"
        tags:
          - key: "checkout.status"
            expected: "complete"
          - key: "cart.items.count"
            required: true
